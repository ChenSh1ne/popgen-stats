---
title: "dadiAnalysis"
author: "Abigail Shockey and Tatum Mortimer"
date: "August 18, 2016"
output: html_document
---



```{r, echo = FALSE, message = FALSE, warning = FALSE}

#log scale nu, separate plots for tau

library(ggplot2)
library(reshape2)
library(cowplot)
ll <- data.frame(a=rep(NA, times = 100))
                 
```

## Expansion

### SFS

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 18, fig.height = 18}

if (file.exists("observedSFS.txt") && file.exists("neutralModelSFS.txt")) {
  observed_SFS <- read.table("observedSFS.txt")
  neutral_SFS <- read.table("neutralModelSFS.txt")
  expansion_SFS <- rbind(data.frame(Model="Observed", 
          Count=observed_SFS$V1,
          Frequency=as.numeric(row.names(observed_SFS))),
      data.frame(Model="Neutral", 
          Count= neutral_SFS$V1,
          Frequency=as.numeric(row.names(observed_SFS))))
}

if (file.exists("expansionModelSFS.txt")) {
  model <- read.table("expansionModelSFS.txt")
  expansion_SFS <- rbind(data.frame(Model = expansion_SFS$Model, 
      Count=expansion_SFS$Count,
      Frequency=expansion_SFS$Frequency),
  data.frame(Model = "Expansion", 
      Count = model$V1, 
      Frequency=as.numeric(row.names(model))))

  ggplot(expansion_SFS, aes(x=Frequency, y=Count, fill=Model)) +
    geom_bar(stat="identity", position="dodge") + 
    scale_fill_brewer(palette="Paired") +
    theme_bw() +
      theme(text = element_text(size=22),
      axis.text.x = element_text(angle=90, vjust=1),
      axis.line = element_line(colour = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      #        panel.border = element_blank(),
      panel.background = element_blank())
}

```

### Parameter Values

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_expansionModel.txt")) {
  expansion_params <- read.table("dadi_expansionModel.txt", header = TRUE)
  params_df <- melt(expansion_params[,1:2], variable.name = "Parameter", value.name = "Value")
  expansion.nu.plot <- ggplot(data = params_df[1:100,], aes(x=Parameter, y=Value)) + geom_boxplot() +
      xlab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  
  expansion.tau.plot <- ggplot(data = params_df[101:200,], aes(x=Parameter, y=Value)) + geom_boxplot() + 
      xlab("") + ylab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  
  plot_grid(expansion.nu.plot, expansion.tau.plot, align = "h")
}

```

### AIC

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_expansionModel.txt")) {
  Expansion <- expansion_params$ll
  ll <- cbind(ll, Expansion)
  avg_expansion_ll <- median(expansion_params$ll)
  cat("Average LL: ", avg_expansion_ll, "\n")
  avg_expansion_AIC <- 2 * 2 - 2 * avg_expansion_ll
  cat("Average AIC: ", avg_expansion_AIC, "\n")
  max_expansion_ll <- max(expansion_params$ll)
  cat("Max LL: ", max_expansion_ll, "\n")
  max_expansion_AIC <- 2 * 2 - 2 * max_expansion_ll
  cat("Max AIC: ", max_expansion_AIC, "\n")
  max_expansion_ll_idx <- which(expansion_params$ll == max_expansion_ll)
  max_expansion_nu <- expansion_params$nu[max_expansion_ll_idx]
  cat("Nu: ", max_expansion_nu, "\n")
  max_expansion_tau <- expansion_params$tau[max_expansion_ll_idx]
  cat("Tau: ", max_expansion_tau, "\n")
}

```

## Growth

### SFS

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 18, fig.height = 18}

growth_SFS <- rbind(data.frame(Model="Observed", 
        Count=observed_SFS$V1,
        Frequency=as.numeric(row.names(observed_SFS))),
    data.frame(Model="Neutral", 
        Count= neutral_SFS$V1,
        Frequency=as.numeric(row.names(observed_SFS))))

if (file.exists("growthModelSFS.txt")) { 
    model <- read.table("growthModelSFS.txt")
    growth_SFS <- rbind(data.frame(Model = growth_SFS$Model, 
            Count=growth_SFS$Count,
            Frequency=growth_SFS$Frequency),
    data.frame(Model = "Exponential Growth", 
            Count = model$V1, 
            Frequency=as.numeric(row.names(model))))
    
    ggplot(growth_SFS, aes(x=Frequency, y=Count, fill=Model)) +
      geom_bar(stat="identity", position="dodge") + 
      scale_fill_brewer(palette="Paired") +
      theme_bw() +
        theme(text = element_text(size=22),
        axis.text.x = element_text(angle=90, vjust=1),
        axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        #        panel.border = element_blank(),
        panel.background = element_blank())
}

```

### Parameter Values

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_growthModel.txt")) {
  growth_params <- read.table("dadi_growthModel.txt", header = TRUE)
  growth.nu.plot <- ggplot(data = params_df[1:100,], aes(x=Parameter, y=Value)) + geom_boxplot() +
      xlab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  
  growth.tau.plot <- ggplot(data = params_df[101:200,], aes(x=Parameter, y=Value)) + geom_boxplot() + 
      xlab("") + ylab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  
  plot_grid(growth.nu.plot, growth.tau.plot, align = "h")
}

```

### AIC

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_growthModel.txt")) {
  Growth <- growth_params$ll
  ll <- cbind(ll, Growth)
  avg_growth_ll = median(growth_params$ll)
  cat("Average LL: ", avg_growth_ll, "\n")
  avg_growth_AIC <- 2 * 2 - 2 * avg_growth_ll
  cat("Average AIC: ", avg_growth_AIC, "\n")
  max_growth_ll = max(growth_params$ll)
  cat("Max LL: ", max_growth_ll, "\n")
  max_growth_AIC <- 2 * 2 - 2 * max_growth_ll  
  cat("Max AIC: ", max_growth_AIC, "\n")
  max_growth_ll_idx <- which(growth_params$ll == max_growth_ll)
  max_growth_nu <- growth_params$nu[max_growth_ll_idx]
  cat("Nu: ", max_growth_nu, "\n")
  max_growth_tau <- growth_params$tau[max_growth_ll_idx]
  cat("Tau: ", max_growth_tau, "\n")
}

```

## Bottlegrowth

### SFS

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 18, fig.height = 18}

bottlegrowth_SFS <- rbind(data.frame(Model="Observed", 
        Count=observed_SFS$V1,
        Frequency=as.numeric(row.names(observed_SFS))),
    data.frame(Model="Neutral", 
        Count= neutral_SFS$V1,
        Frequency=as.numeric(row.names(observed_SFS))))
    
if (file.exists("bottlegrowthModelSFS.txt")) { 
  model <- read.table("bottlegrowthModelSFS.txt")
  bottlegrowth_SFS <- rbind(data.frame(Model = bottlegrowth_SFS$Model, 
                          Count=bottlegrowth_SFS$Count,
                          Frequency=bottlegrowth_SFS$Frequency),
               data.frame(Model = "Bottlegrowth", 
                          Count = model$V1, 
                          Frequency=as.numeric(row.names(model))))

  ggplot(bottlegrowth_SFS, aes(x=Frequency, y=Count, fill=Model)) +
    geom_bar(stat="identity", position="dodge") + 
    scale_fill_brewer(palette="Paired") +
    theme_bw() +
      theme(text = element_text(size=22),
      axis.text.x = element_text(angle=90, vjust=1),
      axis.line = element_line(colour = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      #        panel.border = element_blank(),
      panel.background = element_blank())
}

```

### Parameter Values

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_bottlegrowthModel.txt")) {
  bottlegrowth_params <- read.table("dadi_bottlegrowthModel.txt", header = TRUE)
  params_df <- melt(bottlegrowth_params[,1:3], variable.name = "Parameter", value.name = "Value")
  bottlegrowth.nuB.nuF.plot <- ggplot(data = params_df[1:200,], aes(x=Parameter, y=Value)) + geom_boxplot() +
      xlab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  bottlegrowth.tau.plot <- ggplot(data = params_df[201:300,], aes(x=Parameter, y=Value)) + geom_boxplot() + 
      xlab("") + ylab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  
  plot_grid(bottlegrowth.nuB.nuF.plot,bottlegrowth.tau.plot, align = "h")
}

```

### AIC

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_bottlegrowthModel.txt")) {
  Bottlegrowth <- bottlegrowth_params$ll
  ll <- cbind(ll, Bottlegrowth)
  avg_bottlegrowth_ll = median(bottlegrowth_params$ll)
  cat("Average LL: ", avg_bottlegrowth_ll, "\n")
  avg_bottlegrowth_AIC <- 2 * 2 - 2 * avg_bottlegrowth_ll
  cat("Average AIC: ", avg_bottlegrowth_AIC, "\n")  
  max_bottlegrowth_ll = max(bottlegrowth_params$ll)
  cat("Max LL: ", max_bottlegrowth_ll, "\n")
  max_bottlegrowth_AIC <- 2 * 2 - 2 * max_bottlegrowth_ll  
  cat("Max AIC: ", max_bottlegrowth_AIC, "\n")
  max_bottlegrowth_ll_idx <- which(bottlegrowth_params$ll == max_bottlegrowth_ll)
  max_bottlegrowth_nuB <- bottlegrowth_params$nuB[max_bottlegrowth_ll_idx]
  cat("NuB: ", max_bottlegrowth_nuB, "\n")
  max_bottlegrowth_nuF <- bottlegrowth_params$nuF[max_bottlegrowth_ll_idx]
  cat("NuF: ", max_bottlegrowth_nuF, "\n")
  max_bottlegrowth_tau <- bottlegrowth_params$tau[max_bottlegrowth_ll_idx]
  cat("Tau: ", max_bottlegrowth_tau, "\n")
}


```

## Bottleneck

### SFS

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 18, fig.height = 18}

bottleneck_SFS <- rbind(data.frame(Model="Observed", 
        Count=observed_SFS$V1,
        Frequency=as.numeric(row.names(observed_SFS))),
    data.frame(Model="Neutral", 
        Count= neutral_SFS$V1,
        Frequency=as.numeric(row.names(observed_SFS))))
    
if (file.exists("bottleneckModelSFS.txt")) { 
  model <- read.table("bottleneckModelSFS.txt")
  bottleneck_SFS <- rbind(data.frame(Model = bottleneck_SFS$Model, 
                          Count=bottleneck_SFS$Count,
                          Frequency=bottleneck_SFS$Frequency),
               data.frame(Model = "Bottleneck", 
                          Count = model$V1, 
                          Frequency=as.numeric(row.names(model))))

  ggplot(bottleneck_SFS, aes(x=Frequency, y=Count, fill=Model)) +
    geom_bar(stat="identity", position="dodge") + 
    scale_fill_brewer(palette="Paired") +
    theme_bw() +
      theme(text = element_text(size=22),
      axis.text.x = element_text(angle=90, vjust=1),
      axis.line = element_line(colour = "black"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      #        panel.border = element_blank(),
      panel.background = element_blank())
}

```

### Parameter Values

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_bottleneckModel.txt")) {
  bottleneck_params <- read.table("dadi_bottleneckModel.txt", header = TRUE)
  params_df <- melt(bottleneck_params[,1:4], variable.name = "Parameter", value.name = "Value")
  bottleneck.nuB.nuF.plot <- ggplot(data = params_df[1:200,], aes(x=Parameter, y=Value)) + geom_boxplot() +
      xlab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  bottleneck.tauB.tauF.plot <- ggplot(data = params_df[201:400,], aes(x=Parameter, y=Value)) + geom_boxplot() + 
      xlab("") + ylab("") +
      theme(text = element_text(size=14),
      axis.text.x = element_text(angle=90, vjust=1, size = 12))
  
  plot_grid(bottleneck.nuB.nuF.plot,bottleneck.tauB.tauF.plot, align = "h")
}

```

### AIC

```{r, echo = FALSE, message = FALSE, warning = FALSE}

if (file.exists("dadi_bottleneckModel.txt")) {
  Bottleneck <- bottleneck_params$ll
  ll <- cbind(ll, Bottleneck)
  avg_bottleneck_ll = median(bottleneck_params$ll)
  cat("Average LL: ", avg_bottleneck_ll, "\n")
  avg_bottleneck_AIC <- 2 * 3 - 2 * avg_bottleneck_ll
  cat("Average AIC: ", avg_bottleneck_AIC, "\n")
  max_bottleneck_ll = max(bottleneck_params$ll)
  cat("Max LL: ", max_bottleneck_ll, "\n")
  max_bottleneck_AIC <- 2 * 3 - 2 * max_bottleneck_ll
  cat("Max AIC: ", max_bottleneck_AIC, "\n")
  max_bottleneck_ll_idx <- which(bottleneck_params$ll == max_bottleneck_ll)
  max_bottleneck_nuB <- bottleneck_params$nuB[max_bottleneck_ll_idx]
  cat("NuB: ", max_bottleneck_nuB, "\n")
  max_bottleneck_nuF <- bottleneck_params$nuF[max_bottleneck_ll_idx]
  cat("NuF: ", max_bottleneck_nuF, "\n")
  max_bottleneck_tauB <- bottleneck_params$tauB[max_bottleneck_ll_idx]
  cat("TauB: ", max_bottleneck_tauB, "\n")
  max_bottleneck_tauF <- bottleneck_params$tauF[max_bottleneck_ll_idx]
  cat("TauF: ", max_bottleneck_tauF, "\n")
}

```

## LL

```{r, echo = FALSE, message = FALSE, warning = FALSE}

ll$a <- NULL
ggplot(data = melt(ll, variable.name = "Model", value.name = "LL"), aes(x = Model, y = LL)) + geom_boxplot(aes(color = Model))

```
